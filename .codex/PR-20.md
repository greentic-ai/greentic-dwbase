# .codex/PR-20.md â€” Delta Sync v1 (Bloom Filter Exchange + Missing Atom Request)

## Goal
Implement a first working delta sync: peers exchange bloom filters per world to find missing atoms,
then request and send only missing atoms.

## Deliverables
- Add a lightweight bloom filter implementation (or use a vetted crate).
- Add messages:
  - `BloomOffer { world, window, bloom }`
  - `MissingRequest { world, atom_ids }`
  - `AtomBatch { world, atoms }`
- Engine APIs needed:
  - list atom ids for a world/time window (or by seq range)
  - fetch atoms by ids
  - ingest remote atoms (append to log + index)
- Add throttling/backoff knobs to prevent sync storms.

## Tests
- Two-node test:
  - node A writes atoms
  - node B syncs and ends with same atoms
- Ensure duplicates are ignored safely (idempotent ingestion).

## Acceptance
- Delta sync succeeds locally between two nodes.
- No full scans of entire history; use bounded windows.
