# .codex/PR-46.md — Swarm Hardening: Durable Membership + Authz + Replay Protection

## Goal
Move from “messaging skeleton” to production-credible swarm behavior: durable membership state, capability-aware subscriptions, and replay protection.

## Deliverables
- Persist peer/subscription state to disk:
  - `.dwbase/swarm/state.json` (node) or `DWBASE_DATA_DIR/swarm.json` (component)
- Capability-aware subscription enforcement:
  - receiver ignores worlds it cannot read
  - sender does not push worlds peer is not allowed to receive (policy-driven)
- Add replay protection:
  - per-peer monotonic counters or timestamp windows
  - drop duplicates
- Backpressure:
  - bounded inbox processing with metrics for drops/backoff

## Tests
- Peer table survives restart (state reload).
- Duplicate messages are ignored.

## Acceptance
- Swarm state is observable, durable, and resistant to storms/replays.

