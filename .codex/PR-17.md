# .codex/PR-17.md — Deployment Tooling (Local, Edge, Devnet)

## Codex Execution Rules
- Focus on deployment ergonomics, not DWBase feature expansion.
- Prefer simple, inspectable tooling over “magic”.
- No managed services or cloud dependencies.
- All deploymxent artifacts must be reproducible locally.

## Goal
Provide first-class **deployment tooling** for DWBase v1 so developers and operators can:

- Run a single DWBase node locally
- Run DWBase on edge devices (offline-first)
- Spin up a small multi-node devnet for testing swarm behavior

This PR adds **operational glue**, not new memory or swarm logic.

---

## Deliverables

### A) Deployment CLI / Tool

Create a deployment tool using **one of the following approaches** (pick the cleanest):

- New crate: `crates/dwbase-deploy`
- OR extend `dwbase-cli` with a `deploy` subcommand

The tool must expose:

#### 1) Local deployment
```bash
dwbase deploy local --config ./config.toml
Behavior:

Runs a single DWBase node

Uses local directories for:

data

logs

summaries

Prints:

node id

listening endpoints

data directory paths

2) Devnet deployment
bash
Copy code
dwbase deploy devnet --nodes 3 --base-port 7000
Behavior:

Spawns N DWBase nodes locally (separate processes)

Assigns:

distinct ports

distinct data directories

stable node IDs

Optionally enables swarm/gossip if available

Prints a table of running nodes

Example output:

css
Copy code
Node  ID        Port   Data Dir
----  --------  -----  -------------------------
A     node-a    7000   .dwbase/devnet/node-a
B     node-b    7001   .dwbase/devnet/node-b
C     node-c    7002   .dwbase/devnet/node-c
3) Stop / cleanup
bash
Copy code
dwbase deploy stop
dwbase deploy clean
stop: terminates running devnet processes

clean: removes devnet data directories (explicit confirmation required)

B) Configuration Templates
Add:

lua
Copy code
deploy/
  local.toml
  devnet.toml
  edge.toml
Each template documents:

storage paths

memory limits

network ports

swarm settings (if enabled)

offline mode

These templates are examples, not mandatory defaults.

C) Edge / Offline Support
Document and support:

running DWBase with:

no network

limited disk

limited RAM

environment variable overrides:

DWBASE_DATA_DIR

DWBASE_MAX_RAM_MB

DWBASE_MAX_DISK_MB

Ensure:

node starts cleanly in offline mode

no hard dependency on swarm/network components

D) Process Management
Implementation guidelines:

Use std::process::Command (or equivalent) to spawn nodes

Track child PIDs in:

bash
Copy code
.dwbase/devnet/state.json
Handle:

Ctrl+C cleanup

orphaned process detection

No external process managers (systemd, docker, etc.) in v1.

E) Documentation
Add:

docs/deployment.md

Cover:

Local vs devnet vs edge deployment

Directory layout

Config options

Common failure modes

How to reset a node safely

Include copy-pasteable commands.

Acceptance Criteria
dwbase deploy local starts a working node.

dwbase deploy devnet --nodes 2 starts two nodes concurrently.

Nodes shut down cleanly.

Deployment docs are accurate and runnable.

yaml
Copy code

---
