# .codex/PR-33.md — NATS-based Discovery (Hello/Presence) for component-dwbase

## Goal
Leverage Greentic’s NATS to enable **zero-admin discovery** of DWBase nodes.

## Deliverables
- Add a `dwbase-nats` module/crate (choose one):
  - `crates/dwbase-swarm-nats/` (preferred)
  - or inside `crates/dwbase-swarm/` as a feature `nats`
- Implement:
  - presence publish (periodic):
    - subject: `dwbase.node.hello`
    - payload: `{ node_id, endpoint, worlds_served, trust_score, started_at, version }`
  - presence subscribe:
    - maintain peer table with TTL expiry
- In `component-dwbase`:
  - connect to NATS using Greentic-provided config:
    - `NATS_URL` or `GREENTIC_NATS_URL`
    - optional creds handled via Greentic secrets (do not print)
  - start hello loop in background (component-local task)

## Tests
- Use a test NATS server (docker in CI if allowed) OR a mocked NATS client interface.
- Validate peer table population and expiry.

## Acceptance
- Two component instances on same NATS discover each other without manual peer lists.
