# .codex/PR-42.md — component-dwbase: Health Disk Model (Free Space + Pressure) for WASI

## Goal
Make disk health reporting meaningful in production by distinguishing “capacity configured” vs “filesystem free space”, while staying WASI-friendly.

## Deliverables
- Extend `dwbase.health` to report:
  - `disk_used_bytes` (current data dir footprint)
  - `disk_free_bytes` (if available)
  - `disk_total_bytes` (if available) + `disk_used_percent`
  - `disk_pressure` (derived signal: ok/warn/degraded)
- Implement a cross-platform strategy:
  - Prefer filesystem stats when available (host environments).
  - Fall back to `DWBASE_MAX_DISK_MB` as a configured capacity when FS stats are unavailable.
- Add config/env knobs:
  - `DWBASE_HEALTH_DISK_DEGRADED_PCT`
  - `DWBASE_HEALTH_DISK_WARN_PCT`
  - `DWBASE_MAX_DISK_MB` (capacity fallback)
- Update docs to reflect exact semantics and failure modes.

## Tests
- Health stays `ready` when capacity unknown but storage/index ok.
- Health becomes `degraded` when configured capacity is exceeded.

## Acceptance
- Operators can reliably detect disk pressure and distinguish “unknown capacity” from “healthy”.

